version: 2.1
orbs:
    pus: navikt/pus-orb@0.0.25

workflows:
    version: 2
    commit:
        jobs:
            - pus/test-frontend:
                  name: test

            - pus/bygg-frontend:
                  requires:
                      - test
                  name: build
                  filters:
                      branches:
                          only: master

            - pus/deploy-latest:
                  requires:
                      - build
                  name: deploy2
                  context: pus
                  cluster: dev-fss
                  filepath: ./nais-q-fss.yaml
                  filters:
                      branches:
                          only: master
            - prodsett:
                  requires:
                      - deploy2
                  type: approval
                  filters:
                      branches:
                          only: master

            - pus/deploy-latest:
                  requires:
                      - prodsett
                  context: pus
                  cluster: prod-fss
                  filepath: ./nais-fss.yaml
                  filters:
                      branches:
                          only: master


